import pytest
import visexpa.engine.datahandlers.hdf5io as hdf5io
import numpy
from visexpa.engine.configuration import default_config

@pytest.fixture()
def example_real_hdf_handler():
    ''' Generates dummy recording to test hdfio and synchronization related methods'''
    from visexpa.engine.configuration import default_config
    from visexpa.engine.datahandlers.hdf5io import iopen
    # TODO: generating sync data needs to be implemented, now uses example files from debug folder
    filename = '/mnt/datafast/debug/dani/fragment_xy_center_0_0_-45261.39_LaserPulseC_201808011427467_0.hdf5'  #MESc
    filename = '/mnt/datafast/debug/dani/fragment_xy_W_070518_0_0_-340.0_IRLaser980a_1525700316_0.hdf5'  #RC
    with iopen(filename, default_config) as handler:
        yield handler

def test_iopen(fname='/mnt/datafast/data/20180507/RD1008_980/fragment_xy_W_070518_0_0_-340.0_IRLaser980a_1525700316_0.hdf5'):
    """
    Tests iopen when used in legacy style (returns a file handler) and context manager style.

    """
    fh = hdf5io._iopen(fname, default_config, file_mode='r')
    fh.findvar('stimblock_frame_limits')
    fh.close()
    with hdf5io.iopen(fname, default_config, file_mode='r') as fh1:
        fh1.findvar('stimblock_frame_limits')
    assert all(fh.stimblock_frame_limits['full']['start_i'][0] == fh1.stimblock_frame_limits['full']['start_i'][0])

def test_load_stimpar(fnames=['/mnt/datafast/data/20180507/RD1008_980/fragment_xy_W_070518_0_0_-340.0_IRLaser980a_1525700316_0.hdf5',]):
    for fname in fnames:
        with hdf5io.iopen(fname, default_config, file_mode='r') as fh1:
            fh1.findvar('stimpar')
            #fh1.

def test_saveload_pickled(temp_hdf_handler):
    """
    Tests saving/loading pickled byte array.
    """
    import pickle
    myarray = numpy.random.randn(2,4)
    temp_hdf_handler.pstream = pickle.dumps(myarray)
    temp_hdf_handler.save('pstream')
    del temp_hdf_handler.pstream
    temp_hdf_handler.load('pstream')
    myarray2 = pickle.loads(temp_hdf_handler.pstream)
    numpy.testing.assert_almost_equal(myarray, myarray2, 1)

### TODO: refactor into pytest
import unittest

# from visexpman.users.zoltan.test import unit_test_runner
class TestUtils(unittest.TestCase):
    def setUp(self):
        import os, visexpman, visexpa.engine.configuration
        import visexpman.engine.generic.utils
        from visexpman.engine.generic.file import mkstemp
        self.filename = mkstemp(suffix='.hdf5')
        self.config = visexpman.engine.generic.utils.fetch_classes('visexpa.users.daniel', \
                                                                   classname='Config',
                                                                   required_ancestors=visexpa.engine.configuration.Config)[
            0][1]()

    def tearDown(self):
        os.remove(self.filename)
        pass

    def test_masked_array(self):
        ma0 = numpy.ma.array([1, 2, 3], dtype=float)
        ma0.mask = [1, 0, 1]
        numpy.ma.set_fill_value(ma0, numpy.nan)
        madict = {'anarray': ma0.copy()}
        with closing(Hdf5io(self.filename, filelocking=False)) as h1:
            h1.ma = ma0
            h1.madict = madict
            h1.save(['ma', 'madict'])
            del h1.ma
            del h1.madict
            ma = h1.findvar('ma')
            madict1 = h1.findvar('madict')
        numpy.testing.assert_array_almost_equal(h1.ma, ma0)
        for k1 in madict1:
            numpy.testing.assert_array_almost_equal(madict[k1], madict1[k1])

    def test_1000x1000_error(self):
        import numpy
        from visexpa.engine.datahandlers import datatypes
        a = numpy.ones((1000, 1000, 1, 1), dtype=numpy.uint16)
        h = datatypes.ImageData(self.filename, filelocking=False)
        h.rawdata = a
        h.save('rawdata')
        pass

    def test_dict2hdf(self):
        import copy
        from visexpa.engine.misc.introspect import dict_isequal
        data = {'a': 10, 'b': 5 * [3]}
        data = 4 * [data]
        data2 = {'a': numpy.array(10), 'b': numpy.array(5 * [3])}
        h = Hdf5io(self.filename, filelocking=False)
        h.data = copy.deepcopy(data)
        h.data2 = copy.deepcopy(data2)
        h.save(['data', 'data2'])
        del h.data
        h.load(['data', 'data2'])
        h.close()
        # hdf5io implicitly converts list to ndarray
        self.assertTrue(dict_isequal(data2, h.data2) and data == h.data)

    def test_recarray2hdf(self):
        import copy
        data = numpy.array(list(zip(list(range(10)), list(range(10)))),
                           dtype={'names': ['a', 'b'], 'formats': [numpy.int, numpy.int]})
        data = 4 * [data]
        h = Hdf5io(self.filename, filelocking=False)
        h.data = copy.deepcopy(data)
        h.save(['data'])
        del h.data
        h.load(['data'])
        h.close()
        self.assertTrue((numpy.array(data) == numpy.array(h.data)).all())

    @unittest.skip('this is not a test')
    def test_findvar(self):
        f = os.path.join(unit_test_runner.TEST_reference_data_folder,
                         'fragment_-373.7_-0.8_-160.0_MovingDot_1331897433_3.hdf5')
        h5f = Hdf5io(f, filelocking=False)
        h5f.findvar('MovingDot_1331897433_3')
        res = h5f.findvar(['position', 'machine_config'])
        pass

    def test_complex_data_structure(self):
        item = {}
        item['a1'] = 'a1'
        item['a2'] = 2
        item['a3'] = 5
        items = 5 * [item]
        f = self.filename
        h5f = Hdf5io(f, filelocking=False)
        h5f.items = items
        h5f.save('items', verify=True)
        h5f.close()
        reread = read_item(f, 'items', filelocking=False)
        self.assertEqual(items, reread)

    def test_concurrent_access(self):
        items = [['1.1', '1.2', '1.3'], ['2.1', '2.2']]
        f = self.filename
        h5f = Hdf5io(f, self.config)
        h5f.items = items
        h5f.save('items')
        h5f.close()
        t = threading.Thread(target=lambda f=f, self=self: Hdf5io(f, self.config))
        t.start()
        print((t.is_alive()))
        # t.join()
        handler = _iopen(f, self.config)

    def test_listoflists(self):
        items = [['1.1', '1.2', '1.3'], ['2.1', '2.2']]
        f = self.filename
        h5f = Hdf5io(f, filelocking=False)
        h5f.items = items
        h5f.save('items')
        h5f.close()
        self.assertEqual(items, read_item(f, 'items'), filelocking=False)

    @unittest.skip('this is a bad test')
    def test_more_complex_data_structure(self):
        items = {'rising_edges_indexes': 0,
                 'number_of_fragments': 3,
                 'stimulus_frame_info': [{'elapsed_time': 0,
                                          'stimulus_type': 'show_dots',
                                          'counter': 0,
                                          'is_last': False,
                                          'parameters':
                                              {'duration': 0.0,
                                               'color': [1.0, 1.0, 1.0],
                                               'ndots': 1,
                                               'dot_diameters': [299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994],
                                               'dot_positions': numpy.array([(-299.99999999999994, 151.26084084909542),
                                                                             (-266.66666666666663, 151.26084084909542),
                                                                             (-233.33333333333326, 151.26084084909542),
                                                                             (-199.99999999999991, 151.26084084909542),
                                                                             (2200.0000000000014, 2543.93232337115),
                                                                             (2233.3333333333344, 2543.93232337115),
                                                                             (2266.666666666668, 2543.93232337115),
                                                                             (2300.0000000000014, 2543.93232337115),
                                                                             (2333.333333333335, 2543.93232337115)],
                                                                            dtype=[('row', '<f8'), ('col', '<f8')])}},
                                         {'elapsed_time': 14.625,
                                          'stimulus_type': 'show_dots',
                                          'counter': 719,
                                          'is_last': True,
                                          'parameters':
                                              {'duration': 0.0,
                                               'color': [1.0, 1.0, 1.0],
                                               'ndots': 1,
                                               'dot_diameters': [299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994,
                                                                 299.99999999999994, 299.99999999999994],
                                               'dot_positions': numpy.array([(-299.99999999999994, 151.26084084909542),
                                                                             (-266.66666666666663, 151.26084084909542),
                                                                             (2200.0000000000014, 2543.93232337115),
                                                                             (2233.3333333333344, 2543.93232337115),
                                                                             (2266.666666666668, 2543.93232337115),
                                                                             (2300.0000000000014, 2543.93232337115),
                                                                             (2333.333333333335, 2543.93232337115)],
                                                                            dtype=[('row', '<f8'), ('col', '<f8')])}},
                                         {'elapsed_time': 14.625,
                                          'stimulus_type': 'show_fullscreen',
                                          'counter': 720,
                                          'is_last': False,
                                          'parameters':
                                              {'duration': 0.0,
                                               'color': 0.0,
                                               'flip': True,
                                               'count': True}},
                                         {'elapsed_time': 14.656000137329102,
                                          'stimulus_type': 'show_fullscreen',
                                          'counter': 720,
                                          'is_last': True,
                                          'parameters':
                                              {'duration': 0.0,
                                               'color': 0.0,
                                               'flip': True,
                                               'count': True}}],
                 'generated_data': {'shown_directions': [(90, 720)]},
                 'experiment_source': numpy.array([39, 39, 39, 10, 13, 10], dtype=numpy.uint8),
                 'sync_data': numpy.array([[0., 0.], [0., 0.]]),
                 'actual_fragment': 0,
                 'current_fragment': 0}
        f = self.filename
        h5f = Hdf5io(f, filelocking=False)
        h5f.items = items
        h5f.save('items')
        h5f.close()
        equal = True
        result = read_item(f, 'items', filelocking=False)
        for key in list(result.keys()):
            if isinstance(result[key], list):
                for i0, i1 in zip(items[key], result[key]):
                    # add better equality test here
                    # if i0!=i1:
                    #    equal=False
                    pass
            else:
                if items[key] != result[key]:
                    equal = False

        self.assertTrue(equal)
